<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NetSecurePro — IA22 Video Launcher</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#9aa7b2;
    --accent:#2dd4bf;
    --white:#ecfdf5
  }
  html,body{
    height:100%;margin:0;
    background:linear-gradient(180deg,#071023 0%,#06111a 100%);
    font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
    color:var(--white)
  }
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;box-sizing:border-box}
  .card{
    background:rgba(255,255,255,0.03);
    backdrop-filter:blur(6px);
    border-radius:14px;
    padding:20px;
    max-width:920px;
    width:100%;
    box-shadow:0 8px 30px rgba(2,6,23,0.7)
  }
  header{display:flex;gap:12px;align-items:center}
  .logo{
    width:64px;height:64px;
    border-radius:12px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,#04212a,#093036);
    box-shadow:inset 0 -6px 18px rgba(0,0,0,0.35)
  }
  .title h1{margin:0;font-size:20px}
  .title p{margin:0;color:var(--muted);font-size:13px}
  .status{margin-top:14px;color:var(--muted);font-size:14px}
  .viewer{
    margin-top:18px;
    border-radius:10px;
    overflow:hidden;
    background:#000;
    position:relative;
    padding-top:56.25%;
    height:0
  }
  .viewer iframe,.viewer video{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
  .controls{display:flex;gap:10px;margin-top:14px;align-items:center;flex-wrap:wrap}
  button{background:var(--accent);color:#042018;border:0;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
  .small{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px}
  .meta{margin-top:12px;color:var(--muted);font-size:13px}
  .hidden{display:none}
  @media (max-width:700px){.card{padding:14px}.title h1{font-size:18px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="main" aria-live="polite">
    <header>
      <div class="logo" aria-hidden="true">
        <svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <rect width="24" height="24" rx="6" fill="#002b2a"/>
          <path d="M6 12h12M12 6v12" stroke="#2dd4bf" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="title">
        <h1>NetSecurePro — IA22 Video Launcher</h1>
        <p>Interface embarquée — lanceur de flux sécurisé (YouTube / PeerTube)</p>
      </div>
    </header>

    <div class="status" id="status">Initialisation…</div>

    <div class="viewer" id="viewer" aria-hidden="true"></div>

    <div class="controls">
      <button id="openExternal" class="hidden small">Ouvrir flux externe</button>
      <button id="nextVideo" class="small">Vidéo suivante</button>
      <button id="restart" class="small">Relancer détection</button>
      <button id="showConfig" class="small">Afficher config</button>
    </div>

    <pre id="confView" class="hidden" style="margin-top:12px;background:#01070b;padding:12px;border-radius:8px;color:#cfeee6;overflow:auto;max-height:220px"></pre>

    <div class="meta">
      <strong>Auteur :</strong> Zoubirou Mohammed Ilyes — NetSecurePro<br/>
      <span style="color:var(--muted)">Conseils : pour vidéos privées YouTube, utilisez OAuth côté serveur.</span>
    </div>
  </div>
</div>

<script id="ui-config" type="application/json">
{
  "autoplay": true,
  "allow_fullscreen": true,
  "youtube_privacy_mode": true,
  "behavior": {
    "prefer_embed": true,
    "external_fallback": true,
    "open_in_new_tab_if_embed_blocked": true
  },
  "playlist": [
    {"type": "youtube", "url": "https://youtu.be/VOTRE_VIDEO_PRIVEE_ID"},
    {"type": "peertube", "url": "https://peertube.exemple.com/objects/1234567890abcdef"}
  ]
}
</script>

<script>
(function(){
  const statusEl = document.getElementById('status');
  const viewer = document.getElementById('viewer');
  const confView = document.getElementById('confView');
  const btnExternal = document.getElementById('openExternal');
  const btnRestart = document.getElementById('restart');
  const btnShowConfig = document.getElementById('showConfig');
  const btnNext = document.getElementById('nextVideo');

  function logStatus(txt){ statusEl.textContent = txt; }

  function parseConfig(){
    try{ return JSON.parse(document.getElementById('ui-config').textContent.trim()); }
    catch(e){ console.error("Erreur config:", e); return null; }
  }

  function extractYouTubeId(url){
    if(!url) return null;
    try{
      if(!url.includes('http') && /^[A-Za-z0-9_-]{6,}$/.test(url)) return url;
      const u = new URL(url);
      if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
      if(u.hostname.includes('youtube.com') || u.hostname.includes('youtube-nocookie.com')){
        if(u.pathname.startsWith('/watch')) return u.searchParams.get('v');
        if(u.pathname.startsWith('/embed/')) return u.pathname.split('/embed/')[1];
        if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/shorts/')[1];
      }
      return u.searchParams.get('v') || url;
    }catch(e){ return /^[A-Za-z0-9_-]{6,}$/.test(url) ? url : null; }
  }

  function buildYouTubeEmbedUrl(id,cfg){
    const base = cfg.youtube_privacy_mode?'https://www.youtube-nocookie.com/embed/':'https://www.youtube.com/embed/';
    let url = base + encodeURIComponent(id) + '?rel=0';
    if(cfg.autoplay) url += '&autoplay=1';
    if(cfg.allow_fullscreen) url += '&fs=1';
    return url;
  }

  function buildPeerTubeEmbedUrl(url){ return url; }

  function insertIframe(src, allowFullScreen){
    viewer.innerHTML = '';
    const iframe = document.createElement('iframe');
    iframe.setAttribute('src', src);
    iframe.setAttribute('allow','accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture');
    if(allowFullScreen) iframe.setAttribute('allowfullscreen','true');
    iframe.addEventListener('load',()=>{ logStatus('Flux chargé.'); viewer.setAttribute('aria-hidden','false'); btnExternal.classList.add('hidden'); });
    iframe.addEventListener('error',()=>{ checkEmbedBlocked(src); });
    viewer.appendChild(iframe);
    setTimeout(()=> checkEmbedBlocked(src), 2500);
  }

  function checkEmbedBlocked(src){
    const cfg = window.IA22cfg || {};
    if(cfg.behavior?.external_fallback){
      btnExternal.classList.remove('hidden');
      btnExternal.onclick = ()=> window.open(src,'_blank');
      logStatus('Embed peut être bloqué — ouverture externe disponible.');
    } else logStatus('Embed inséré — vérifiez flux si nécessaire.');
  }

  function openExternalDirect(url){ try{ window.open(url,'_blank'); }catch(e){ location.href=url; } }

  let playlist = [], currentIndex = 0;
  function playNext(){
    if(!playlist.length) return;
    if(currentIndex >= playlist.length) currentIndex = 0;
    const item = playlist[currentIndex++];
    if(item.type==='youtube'){ const id=extractYouTubeId(item.url); insertIframe(buildYouTubeEmbedUrl(id, window.IA22cfg), window.IA22cfg.allow_fullscreen); btnExternal.onclick=()=>openExternalDirect(item.url); logStatus('Lecture YouTube (embed) …'); }
    if(item.type==='peertube'){ insertIframe(buildPeerTubeEmbedUrl(item.url), window.IA22cfg.allow_fullscreen); btnExternal.onclick=()=>openExternalDirect(item.url); logStatus('Lecture PeerTube (embed) …'); }
  }

  function runDetection(){
    const cfg = parseConfig();
    if(!cfg){ logStatus('Impossible de lire la configuration.'); return; }
    window.IA22cfg = cfg;
    confView.textContent = JSON.stringify(cfg,null,2);
    playlist = cfg.playlist || [];
    currentIndex = 0;
    if(playlist.length) playNext();
    else logStatus('Aucune vidéo dans la playlist.'); 
  }

  btnRestart.addEventListener('click',()=>{ logStatus('Relancement…'); runDetection(); });
  btnShowConfig.addEventListener('click',()=>{
    confView.classList.toggle('hidden');
    btnShowConfig.textContent = confView.classList.contains('hidden')?'Afficher config':'Masquer config';
  });
  btnNext.addEventListener('click', playNext);

  runDetection();
})();
</script>
</body>
</html>
